(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{155:function(e,t,n){var a="http://localhost:4000/graphql";a=Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_WEBSOCKET_PORT:"ws://localhost:4000/graphql",REACT_APP_HTTP_PORT:"http://localhost:4000/graphql"}).PORT,e.exports={WSPORT:"ws://localhost:4000/graphql",PORT:a}},258:function(e,t,n){e.exports=n(433)},422:function(e,t,n){},423:function(e,t,n){},433:function(e,t,n){"use strict";n.r(t);var a=n(246),r=n(0),o=n.n(r),c=n(50),l=n.n(c),u=function(e){return{type:"SET_MAP_CLASS",value:e}},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"startMap",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MAP_CLASS":return t.value;default:return e}},s=function(e){return{type:"SET_FORM_CLASS",value:e}},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"startForm",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_FORM_CLASS":return t.value;default:return e}},p=function(e){return{type:"SET_ROUTES",value:e}},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROUTES":return t.value;default:return e}},f=n(45),g={setMapClass:u,setFormClass:s,setRoutes:p},v=Object(f.b)(null,g)(function(e){var t=e.setMapClass,n=e.setFormClass,a=e.setRoutes;return o.a.createElement("div",{className:"mainHeader"},o.a.createElement("span",{className:"mainHeader logo",onClick:function(){n("startForm"),t("startMap"),a([])}}))}),E=n(39),b=n.n(E),h=n(54),C=n(28),O=n(444),y=function(e){var t=new Date(e),n=t.getHours(),a=t.getMinutes();return a<10?"".concat(n,":0").concat(a):"".concat(n,":").concat(a)},T=n(66),j=function(e){var t=e.leg,n=y(t.startTime),a=function(e){var t,n=Math.round(e);if(n>1e3){var a=Math.round(n%1e3/100),r=Math.floor(n/1e3);t="".concat(r,".").concat(a,"km")}else t="".concat(n,"m");return t}(t.distance);return o.a.createElement("li",{className:"timelineEvent"},o.a.createElement("span",{className:"timelineTime"},n),o.a.createElement("span",{className:"timelineSpacer"}),o.a.createElement("span",{className:"timelineFrom"},t.from.name),o.a.createElement(T.a,{name:"blind"}),o.a.createElement("span",{className:"timelineInfo"},a))},S=n(447),R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ACTIVE_TRAIL":return t.value;default:return e}},w=n(59),x=n(80);function A(){var e=Object(w.a)(["\n    width: 100%;\n    background-color: ",";\n\n    height: 7px;\n    z-index: 0;\n    border-radius: 3px;\n  "]);return A=function(){return e},e}function F(){var e=Object(w.a)(["\n    ","\n    display: flex;\n    height: 100%;\n    width: 100%;\n    align-items: center;\n  "]);return F=function(){return e},e}function k(){var e=Object(w.a)(["\n    position: inherit;\n    display: flex;\n    flex-direction: column;\n    flex-grow: 1;\n    width: 100%;\n    left: 0%;\n    align-items: left;\n    justify-content: space-between;\n    z-index: 10;\n  "]);return k=function(){return e},e}function _(){var e=Object(w.a)(["\n    position: relative;\n    display: flexbox;\n    width: 150%;\n    flex-wrap: wrap;\n    flex-grow: 2;\n    ","\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n  "]);return _=function(){return e},e}function N(){var e=Object(w.a)(["\n    flex-grow: 1;\n    overflow: hidden;\n    position: relative;\n    white-space: nowrap;\n    ","\n  "]);return N=function(){return e},e}var L=function(e){var t=e.leg,n="purple",a="train",r=y(t.startTime);"SUBWAY"===t.mode&&(n="orange",a="subway"),"BUS"===t.mode&&(n="blue",a="bus"),"WALK"===t.mode&&(n="lightblue",a="blind"),console.log("leg:",t);var c=x.a.span(N(),""),l=x.a.span(_(),""),u=x.a.span(k()),i=x.a.span(F(),""),s=x.a.span(A(),function(e){return e.color});return s.defaultProps={color:n},console.log("color:",n),o.a.createElement(l,null,o.a.createElement(u,null,"WALK"===t.mode?null:o.a.createElement(c,{key:t.from.name},t.from.stop.name),o.a.createElement("div",null,o.a.createElement(T.a,{name:a}),t.trip.route.shortName),r),o.a.createElement(i,null,o.a.createElement(s,{color:n})))},M=function(e){var t=e.route,n=y(t.legs[t.legs.length-1].endTime),a=y(t.legs[0].startTime),r=t.legs.length,c=0;t.legs.forEach(function(e){"WALK"!==e.mode&&c++});var l=42/c+"ch";return o.a.createElement("span",{className:"routePreviewContainer"},o.a.createElement("span",null,a),t.legs.map(function(e){return"WALK"===e.mode&&1!==r?null:o.a.createElement("span",null,"WALK"===e.mode&&1!==r?null:o.a.createElement(L,{classnameProp:"".concat(e.from.stop.code).concat(e.startTime),leg:e,maxwidth:l}))}),o.a.createElement("span",null,n))},P={setActiveTrail:function(e){return{type:"SET_ACTIVE_TRAIL",value:e}}},B=Object(f.b)(function(e){return{routes:e.routeReducer}},P)(function(e){var t=e.setActiveTrail,n=e.routes,a=Object(r.useState)(-1),c=Object(C.a)(a,2),l=c[0],u=c[1],i=-1,s=function(e,n){var a=n.index,r=l===a?-1:a;r>=0&&t(r),u(r)};return 0===n.length?o.a.createElement(o.a.Fragment,null):o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,{fluid:!0,styled:!0},n.map(function(e){return i++,o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a.Title,{onClick:s,index:i,active:l===i},o.a.createElement("span",{key:e.distance},o.a.createElement(M,{route:e}))),o.a.createElement(S.a.Content,{active:l===i},o.a.createElement("span",{className:"timeline"},e.legs.map(function(e){return o.a.createElement("div",{key:e.distance},o.a.createElement(j,{leg:e}))}))))})))}),W=n(449),I=n(65),V=n.n(I),$=n(226),D=n.n($),U=function(){var e=Object(h.a)(b.a.mark(function e(t){var n,a,r,o,c,l,u,i,s;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],a=function(e){var t=e.data.features.map(function(e){return{title:e.properties.label,layer:e.properties.layer}});n=n.concat(t)},!t){e.next=30;break}return e.prev=3,r="https://api.digitransit.fi/geocoding/v1/search",o="https://api.digitransit.fi/geocoding/v1/autocomplete",c="boundary.polygon=25.5345%2060.2592%2C25.3881%2060.1693%2C25.3559%2060.102%2C25.3293%2059.9371%2C24.2831%2059.78402%2C24.2721%2059.95501%2C24.2899%2060.00895%2C24.3087%2060.01947%2C24.1994%2060.12753%2C24.1362%2060.1114%2C24.1305%2060.12847%2C24.099%2060.1405%2C24.0179%2060.1512%2C24.0049%2060.1901%2C24.0445%2060.1918%2C24.0373%2060.2036%2C24.0796%2060.2298%2C24.1652%2060.2428%2C24.3095%2060.2965%2C24.3455%2060.2488%2C24.428%2060.3002%2C24.5015%2060.2872%2C24.4888%2060.3306%2C24.5625%2060.3142%2C24.5957%2060.3242%2C24.6264%2060.3597%2C24.666%2060.3638%2C24.7436%2060.3441%2C24.9291%2060.4523%2C24.974%2060.5253%2C24.9355%2060.5131%2C24.8971%2060.562%2C25.0388%2060.5806%2C25.1508%2060.5167%2C25.1312%2060.4938%2C25.0385%2060.512%2C25.057%2060.4897%2C25.0612%2060.4485%2C25.1221%2060.4474%2C25.1188%2060.4583%2C25.149%2060.4621%2C25.1693%2060.5062%2C25.2242%2060.5016%2C25.3661%2060.4118%2C25.3652%2060.3756%2C25.5345%2060.2592&size=4",e.next=9,V.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=venue&").concat(c));case 9:return l=e.sent,a(l),e.next=13,V.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=street&").concat(c));case 13:return u=e.sent,a(u),e.next=17,V.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=address&").concat(c));case 17:return i=e.sent,a(i),e.next=21,V.a.get("".concat(o,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=stop&").concat(c));case 21:return s=e.sent,console.log("stops:",s),a(s),e.abrupt("return",D.a.take(n,16));case 27:e.prev=27,e.t0=e.catch(3),console.log("REST API ERROR: ",e.t0);case 30:case"end":return e.stop()}},e,null,[[3,27]])}));return function(t){return e.apply(this,arguments)}}(),K=n(227),q=n.n(K),z=function(e){var t=e.fieldName,n=e.inputValue,a=e.setInputValue,c=Object(r.useState)(!1),l=Object(C.a)(c,2),u=l[0],i=l[1],s=Object(r.useState)([]),m=Object(C.a)(s,2),p=m[0],d=m[1],f=q()(function(){var e=Object(h.a)(b.a.mark(function e(t){var n;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<1)){e.next=2;break}return e.abrupt("return",v());case 2:return e.next=4,U(t);case 4:n=e.sent,console.log("autocompleteResults:",n),i(!1),d(n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),200,[]),g=Object(C.a)(f,1)[0],v=function(){i(!1),d([]),a("")};return o.a.createElement(W.a,{fluid:!0,loading:u,onSearchChange:function(e){i(!0),a(e.target.value),g(e.target.value)},onResultSelect:function(e,t){var n=t.result;return a(n.title)},results:p,value:n,placeholder:t,resultRenderer:function(e){var t,n=e.title,a=e.layer;return t="venue"===a?"building":"stop"===a?"flag":"address"===a?"point":"map signs",o.a.createElement("div",null,o.a.createElement(T.a,{name:t}),n)}})},G=n(452),H=n(446),Y=n(443),Z=n(435),J=n(445),Q=function(e){return{type:"SET_BACKGROUND_MAP_LOCATION",value:e}},X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[60.1673319317496,24.80082397460938],[60.158966553797576,25.063716125488284]],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_BACKGROUND_MAP_LOCATION":return t.value;default:return e}},ee=n(150);function te(){var e=Object(w.a)(["\n  query planRoute(\n    $latFrom: Float\n    $lonFrom: Float\n    $latTo: Float\n    $lonTo: Float\n    $time: String\n    $date: String\n    $arriveBy: Boolean\n  ) {\n    planRoute(\n      latFrom: $latFrom\n      lonFrom: $lonFrom\n      latTo: $latTo\n      lonTo: $lonTo\n      time: $time\n      date: $date\n      arriveBy: $arriveBy\n    ) {\n      walkDistance\n      duration\n      legs {\n        legGeometry {\n          points\n        }\n        mode\n        startTime\n        endTime\n        trip {\n          route {\n            shortName\n            longName\n          }\n          tripHeadsign\n          stops {\n            name\n          }\n        }\n        from {\n          lat\n          lon\n          name\n          stop {\n            code\n            name\n          }\n        }\n        to {\n          lat\n          lon\n          name\n        }\n        distance\n      }\n    }\n  }\n"]);return te=function(){return e},e}var ne=Object(ee.a)(te()),ae=function(){var e=Object(h.a)(b.a.mark(function e(t){var n,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.get("https://api.digitransit.fi/geocoding/v1/search?text=".concat(t,"&size=1"));case 2:return n=e.sent,a=n.data.features[0].geometry.coordinates,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),re={setRoutes:p,setBackgroundLocation:Q,setMapClass:u,setClassState:s},oe=Object(f.b)(function(e){return{routes:e.routeReducer,classState:e.formClassReducer}},re)(function(e){var t=e.setRoutes,n=e.setBackgroundLocation,a=e.setMapClass,c=e.classState,l=e.setClassState,u=Object(r.useState)(""),i=Object(C.a)(u,2),s=i[0],m=i[1],p=Object(r.useState)(""),d=Object(C.a)(p,2),f=d[0],g=d[1],v=Object(r.useState)(!1),E=Object(C.a)(v,2),j=E[0],S=E[1],R=Object(r.useState)(""),w=Object(C.a)(R,2),x=w[0],A=w[1],F=Object(r.useState)(""),k=Object(C.a)(F,2),_=k[0],N=k[1],L=Object(r.useState)("NOW"),M=Object(C.a)(L,2),P=M[0],W=M[1],I=function(){A(y(Date.now())),N(function(){var e=new Date,t=e.getMonth()<9?"0".concat(e.getMonth()+1):"".concat(e.getMonth()+1),n=e.getFullYear(),a=e.getDate()<10?"0".concat(e.getDate()):"".concat(e.getDate());return"".concat(n,"-").concat(t,"-").concat(a)}())},V=Object(O.b)();Object(r.useEffect)(function(){I()},[]);var $=function(){var e=Object(h.a)(b.a.mark(function e(r){var o,c,u,i;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),t([]),""===s||""===f){e.next=19;break}return S(!0),l("resultsForm"),e.next=7,ae(s);case 7:return o=e.sent,e.next=10,ae(f);case 10:return c=e.sent,n([[o[1],o[0]],[c[1],c[0]]]),a("resultsMap"),e.next=15,V.query({query:ne,variables:{latFrom:o[1],lonFrom:o[0],latTo:c[1],lonTo:c[0],time:"".concat(x,":00"),date:_,arriveBy:"ARRIVE_BY"===P}});case 15:u=e.sent,i=u.data.planRoute,S(!1),t(i);case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return o.a.createElement("div",{className:c},o.a.createElement(G.a,{raised:!0,style:{marginBottom:0}},o.a.createElement(H.a,{onSubmit:$},o.a.createElement(H.a.Field,null,o.a.createElement(z,{inputValue:s,setInputValue:m,fieldName:"from"})),o.a.createElement(H.a.Field,null,o.a.createElement(z,{inputValue:f,setInputValue:g,fieldName:"to"})),o.a.createElement(H.a.Group,{inline:!0},o.a.createElement(H.a.Select,{defaultValue:"NOW",selection:!0,fluid:!0,options:[{key:1,value:"NOW",text:"Now"},{key:2,value:"LEAVE_AT",text:"Leave at"},{key:3,value:"ARRIVE_BY",text:"Arrive by"}],onChange:function(e,t){var n=t.value;W(n),"NOW"===n&&I()}}),"NOW"!==P?o.a.createElement(o.a.Fragment,null,o.a.createElement(H.a.Field,null,o.a.createElement(Y.a,{defaultValue:x,type:"time",onChange:function(e){return A(e.target.value)}})),o.a.createElement(H.a.Field,null,o.a.createElement(Y.a,{type:"date",style:{maxWidth:"163px"},value:_,onChange:function(e){return N(e.target.value)}}))):null),o.a.createElement(H.a.Field,null,o.a.createElement(Z.a,{animated:!0,primary:!0,type:"submit"},o.a.createElement(Z.a.Content,{visible:!0},"Search"),o.a.createElement(Z.a.Content,{hidden:!0},o.a.createElement(T.a,{name:"arrow right"})))))),o.a.createElement(B,null),o.a.createElement(J.a,{inline:"centered",active:j,style:{marginTop:"10px"}}))}),ce=n(245),le=(n(421),n(448)),ue=n(451),ie=n(453),se=n(154),me=n.n(se),pe={setLatlng:Q},de=Object(f.b)(function(e){return{latlng:e.backgroundMapReducer,routes:e.routeReducer,activeTrail:e.trailReducer,mapClass:e.mapClassReducer}},pe)(function(e){e.latlng,e.setLatlng;var t=e.routes,n=e.activeTrail,a=e.mapClass,c=Object(r.useState)([]),l=Object(C.a)(c,2),u=l[0],i=l[1],s=Object(r.useState)([60.16646629936403,24.94205474853516]),m=Object(C.a)(s,2),p=m[0];m[1];return Object(r.useEffect)(function(){var e=[];if(t.length>0){e=t.reduce(function(e,t,a){return a!==n?[].concat(Object(ce.a)(e),[t.legs.map(function(e){return{color:"gray",decodedTrail:me.a.decode(e.legGeometry.points)}})]):e},[]),console.log("activeTrail:",n),console.log("routes:",t);var a=t[n].legs.map(function(e){var t="green";return"WALK"===e.mode?t="lightblue":"SUBWAY"===e.mode?t="orange":"BUS"===e.mode?t="blue":"RAIL"===e.mode&&(t="red"),{color:t,decodedTrail:me.a.decode(e.legGeometry.points),active:!0}});e.push(a)}console.log("alltrains:",e),i(e)},[t,n,a]),o.a.createElement(o.a.Fragment,null,o.a.createElement(le.a,{className:a,center:p,zoom:13,maxZoom:19,attributionControl:!0,zoomControl:!0,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!0,animate:!0,easeLinearity:.35,boundsOptions:{padding:[10,10]},onclick:function(e){console.log("lat, lng",[e.latlng.lat,e.latlng.lng])}},u.map(function(e){return e.map(function(e){return o.a.createElement(ue.a,{color:e.color,positions:e.decodedTrail})})}),o.a.createElement(ie.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})))}),fe=(n(422),n(423),function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(v,null),o.a.createElement(de,null),o.a.createElement(oe,null))}),ge=n(243),ve=n(79),Ee=n(240),be=Object(ve.c)({backgroundMapReducer:X,routeReducer:d,trailReducer:R,mapClassReducer:i,formClassReducer:m}),he=Object(ve.d)(be,Object(ve.a)(Ee.a)),Ce=n(56),Oe=n(75),ye=n(64),Te=n(242),je=n(19),Se=n(241),Re=n(6),we=n(155),xe=n.n(we),Ae=new Se.a({uri:xe.a.WSPORT,options:{reconnect:!0}}),Fe=Object(Oe.b)({uri:xe.a.PORT}),ke=Object(Te.a)(function(e,t){var n=t.headers,r=localStorage.getItem("app-user-token");return{headers:Object(a.a)({},n,{authorization:r?"bearer ".concat(r):null})}}),_e=Object(je.d)(function(e){var t=e.query,n=Object(Re.k)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},Ae,ke.concat(Fe)),Ne=new Ce.a({link:_e,cache:new ye.a});l.a.render(o.a.createElement(ge.a,{client:Ne},o.a.createElement(O.a,{client:Ne},o.a.createElement(f.a,{store:he},o.a.createElement(fe,null)))),document.getElementById("root"))}},[[258,1,2]]]);
//# sourceMappingURL=main.0eef9b56.chunk.js.map