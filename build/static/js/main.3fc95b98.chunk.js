(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{252:function(e,t,a){e.exports=a(436)},426:function(e,t,a){},436:function(e,t,a){"use strict";a.r(t);var n=a(210),r=a(0),l=a.n(r),o=a(46),c=a.n(o),u=a(451),s=a(457),i=function(e){return{type:"SET_MAP_CLASS",value:e}},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"startMap",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MAP_CLASS":return t.value;default:return e}},d=function(e){return{type:"SET_FORM_CLASS",value:e}},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"startForm",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_FORM_CLASS":return t.value;default:return e}},g=function(e){return{type:"SET_ROUTES",value:e}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROUTES":return t.value;default:return e}},v=a(40),E={setMapClass:i,setFormClass:d,setRoutes:g},C=Object(v.b)(null,E)(function(e){var t=e.setMapClass,a=e.setFormClass,n=e.setRoutes;return l.a.createElement(l.a.Fragment,null,l.a.createElement(u.a,{className:"menu",inverted:!0,color:"blue",borderless:!0},l.a.createElement(u.a.Item,{name:"BetterHsl",active:!1,onClick:function(){a("startForm"),t("startMap"),n([])}},l.a.createElement(s.a,null,"BetterHsl"))))}),b=a(48),h=a.n(b),y=a(74),O=a(29),S=a(219),j=a(446),T=a(237),x=a(53),w=a.n(x),F=function(e){var t=new Date(e),a=t.getHours(),n=t.getMinutes();return n<10?"".concat(a,":0").concat(n):"".concat(a,":").concat(n)},R=function(e){var t=e.leg,a=F(t.startTime),n=function(e){var t,a=Math.round(e);if(a>1e3){var n=Math.round(a%1e3/100),r=Math.floor(a/1e3);t="".concat(r,".").concat(n,"km")}else t="".concat(a,"m");return t}(t.distance);return l.a.createElement("div",null,l.a.createElement("p",null),l.a.createElement("div",null,l.a.createElement("b",null,t.from.name),l.a.createElement("div",null,"Mode: ",t.mode),t.trip&&l.a.createElement("div",null,t.trip.route.shortName," ",t.trip.tripHeadsign),l.a.createElement("div",null,"Distance: ",n),l.a.createElement("div",null,"Departure: ",a),l.a.createElement("div",null,"To: ",t.to.name)))},k=a(450),A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ACTIVE_TRAIL":return t.value;default:return e}},N=a(60),M=function(e){var t=e.route;console.log("route:",t);var a=F(t.legs[t.legs.length-1].endTime),n=F(t.legs[0].startTime),r=0;t.legs.forEach(function(e){"WALK"!==e.mode&&r++});var o=33/r+"ch";return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"routePreviewContainer"},t.legs.map(function(e){return"WALK"===e.mode?l.a.createElement(l.a.Fragment,null):l.a.createElement("span",{className:"routePreview",style:{maxWidth:o},key:e.duration},e.from.stop.name)})),l.a.createElement("div",null),l.a.createElement("span",{className:"divided"},l.a.createElement("span",{className:"previewDeparture"},n),t.legs.map(function(e){var t="red",a="train";return"WALK"===e.mode?l.a.createElement(l.a.Fragment,null):("SUBWAY"===e.mode?(t="orange",a="subway"):"BUS"===e.mode&&(t="blue",a="bus"),l.a.createElement(l.a.Fragment,null,l.a.createElement("span",null,l.a.createElement(N.a,{name:a})),l.a.createElement("span",{style:{color:t},className:"divider"})))}),l.a.createElement("span",{className:"previewArrival"},a),l.a.createElement(N.a,{name:"angle down",className:"expand_route",size:"big"})),l.a.createElement("div",null,l.a.createElement("span",{className:"routePreviewContainer"},t.legs.map(function(e){return"WALK"===e.mode?l.a.createElement(l.a.Fragment,null):l.a.createElement("span",{className:"routePreview",style:{maxWidth:o}},e.trip.route.shortName)}))))},_={setActiveTrail:function(e){return{type:"SET_ACTIVE_TRAIL",value:e}}},L=Object(v.b)(function(e){return{routes:e.routeReducer}},_)(function(e){var t=e.setActiveTrail,a=e.routes,n=Object(r.useState)(-1),o=Object(O.a)(n,2),c=o[0],u=o[1],s=-1,i=function(e,a){var n=a.index,r=c===n?-1:n;r>=0&&t(r),u(r)};return 0===a.length?l.a.createElement(l.a.Fragment,null):l.a.createElement(l.a.Fragment,null,l.a.createElement("p",null),l.a.createElement(k.a,{fluid:!0,styled:!0},a.map(function(e){return s++,l.a.createElement(l.a.Fragment,null,l.a.createElement(k.a.Title,{onClick:i,index:s,active:c===s},l.a.createElement("span",{key:e.distance},l.a.createElement(M,{route:e}))),l.a.createElement(k.a.Content,{active:c===s},l.a.createElement("b",null,"Route legs"),e.legs.map(function(e){return l.a.createElement("div",{key:e.distance},l.a.createElement("p",null),l.a.createElement(R,{leg:e}))})))})))}),B=a(145),D=a.n(B),$=a(453),W=function(){var e=Object(y.a)(h.a.mark(function e(t){var a,n,r,l,o,c,u,s,i;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],n=function(e){var t=e.data.features.map(function(e){return{title:e.properties.label,layer:e.properties.layer}});a=a.concat(t)},!t){e.next=24;break}return r="http://api.digitransit.fi/geocoding/v1/search",l="http://api.digitransit.fi/geocoding/v1/autocomplete",o="boundary.polygon=25.5345%2060.2592%2C25.3881%2060.1693%2C25.3559%2060.102%2C25.3293%2059.9371%2C24.2831%2059.78402%2C24.2721%2059.95501%2C24.2899%2060.00895%2C24.3087%2060.01947%2C24.1994%2060.12753%2C24.1362%2060.1114%2C24.1305%2060.12847%2C24.099%2060.1405%2C24.0179%2060.1512%2C24.0049%2060.1901%2C24.0445%2060.1918%2C24.0373%2060.2036%2C24.0796%2060.2298%2C24.1652%2060.2428%2C24.3095%2060.2965%2C24.3455%2060.2488%2C24.428%2060.3002%2C24.5015%2060.2872%2C24.4888%2060.3306%2C24.5625%2060.3142%2C24.5957%2060.3242%2C24.6264%2060.3597%2C24.666%2060.3638%2C24.7436%2060.3441%2C24.9291%2060.4523%2C24.974%2060.5253%2C24.9355%2060.5131%2C24.8971%2060.562%2C25.0388%2060.5806%2C25.1508%2060.5167%2C25.1312%2060.4938%2C25.0385%2060.512%2C25.057%2060.4897%2C25.0612%2060.4485%2C25.1221%2060.4474%2C25.1188%2060.4583%2C25.149%2060.4621%2C25.1693%2060.5062%2C25.2242%2060.5016%2C25.3661%2060.4118%2C25.3652%2060.3756%2C25.5345%2060.2592&size=4",e.next=8,w.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=venue&").concat(o));case 8:return c=e.sent,n(c),e.next=12,w.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=street&").concat(o));case 12:return u=e.sent,n(u),e.next=16,w.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=address&").concat(o));case 16:return s=e.sent,n(s),e.next=20,w.a.get("".concat(l,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=stop&").concat(o));case 20:return i=e.sent,console.log("stops:",i),n(i),e.abrupt("return",D.a.take(a,16));case 24:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),I=a(220),V=a.n(I),z=function(e){var t=e.fieldName,a=e.inputValue,n=e.setInputValue,o=Object(r.useState)(!1),c=Object(O.a)(o,2),u=c[0],s=c[1],i=Object(r.useState)([]),m=Object(O.a)(i,2),d=m[0],p=m[1],g=V()(function(){var e=Object(y.a)(h.a.mark(function e(t){var a;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<1)){e.next=2;break}return e.abrupt("return",v());case 2:return e.next=4,W(t);case 4:a=e.sent,console.log("autocompleteResults:",a),s(!1),p(a);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),200,[]),f=Object(O.a)(g,1)[0],v=function(){s(!1),p([]),n("")};return l.a.createElement($.a,{fluid:!0,loading:u,onSearchChange:function(e){s(!0),n(e.target.value),f(e.target.value)},onResultSelect:function(e,t){var a=t.result;return n(a.title)},results:d,value:a,placeholder:t,resultRenderer:function(e){var t,a=e.title,n=e.layer;return t="venue"===n?"building":"stop"===n?"flag":"address"===n?"point":"map signs",l.a.createElement("div",null,l.a.createElement(N.a,{name:t}),a)}})},P=a(455),U=a(448),K=a(438),q=a(449),G=a(445),H=a(447),Y=function(e){return{type:"SET_BACKGROUND_MAP_LOCATION",value:e}},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[60.192059,24.945831],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_BACKGROUND_MAP_LOCATION":return t.value;default:return e}};function J(){var e=Object(S.a)(["\n  query planRoute(\n    $latFrom: Float\n    $lonFrom: Float\n    $latTo: Float\n    $lonTo: Float\n    $time: String\n    $date: String\n    $arriveBy: Boolean\n  ) {\n    planRoute(\n      latFrom: $latFrom\n      lonFrom: $lonFrom\n      latTo: $latTo\n      lonTo: $lonTo\n      time: $time\n      date: $date\n      arriveBy: $arriveBy\n    ) {\n      walkDistance\n      duration\n      legs {\n        legGeometry {\n          points\n        }\n        mode\n        startTime\n        endTime\n        trip {\n          route {\n            shortName\n            longName\n          }\n          tripHeadsign\n          stops {\n            name\n          }\n        }\n        from {\n          lat\n          lon\n          name\n          stop {\n            code\n            name\n          }\n        }\n        to {\n          lat\n          lon\n          name\n        }\n        distance\n      }\n    }\n  }\n"]);return J=function(){return e},e}var Q=Object(T.a)(J()),X={setRoutes:g,setBackgroundLocation:Y,setMapClass:i,setClassState:d},ee=Object(v.b)(function(e){return{routes:e.routeReducer,classState:e.formClassReducer}},X)(function(e){var t=e.setRoutes,a=e.setBackgroundLocation,n=e.setMapClass,o=e.classState,c=e.setClassState,u=Object(r.useState)("berliininkatu"),s=Object(O.a)(u,2),i=s[0],m=s[1],d=Object(r.useState)("h\xf6sm\xe4ri"),p=Object(O.a)(d,2),g=p[0],f=p[1],v=Object(r.useState)(!1),E=Object(O.a)(v,2),C=E[0],b=E[1],S=Object(r.useState)(""),T=Object(O.a)(S,2),x=T[0],R=T[1],k=Object(r.useState)(""),A=Object(O.a)(k,2),M=A[0],_=A[1],B=Object(r.useState)(!1),D=Object(O.a)(B,2),$=D[0],W=D[1],I=Object(j.b)();Object(r.useEffect)(function(){R(F(Date.now())),_(function(){var e=new Date,t=e.getMonth()<9?"0".concat(e.getMonth()+1):"".concat(e.getMonth()+1),a=e.getFullYear(),n=e.getDate()<10?"0".concat(e.getDate()):"".concat(e.getDate());return"".concat(a,"-").concat(t,"-").concat(n)}())},[]);var V=function(){var e=Object(y.a)(h.a.mark(function e(r){var l,o,u,s,m,d;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),t([]),""===i||""===g){e.next=21;break}return b(!0),c("resultsForm"),e.next=7,w.a.get("https://api.digitransit.fi/geocoding/v1/search?text=".concat(i,"&size=1"));case 7:return l=e.sent,e.next=10,w.a.get("https://api.digitransit.fi/geocoding/v1/search?text=".concat(g,"&size=1"));case 10:return o=e.sent,u=l.data.features[0].geometry.coordinates,s=o.data.features[0].geometry.coordinates,a([u[1],u[0]]),n("resultsMap"),e.next=17,I.query({query:Q,variables:{latFrom:u[1],lonFrom:u[0],latTo:s[1],lonTo:s[0],time:"".concat(x,":00"),date:M,arriveBy:$}});case 17:m=e.sent,d=m.data.planRoute,b(!1),t(d);case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return l.a.createElement("div",{className:o},l.a.createElement(P.a,{raised:!0},l.a.createElement(U.a,{onSubmit:V},l.a.createElement(U.a.Field,null,l.a.createElement(z,{inputValue:i,setInputValue:m,fieldName:"from"})),l.a.createElement(U.a.Field,null,l.a.createElement(z,{inputValue:g,setInputValue:f,fieldName:"to"})),l.a.createElement(U.a.Field,null,l.a.createElement("div",{className:"toggleSearchTime"},l.a.createElement(K.a,{animated:!0,type:"submit"},l.a.createElement(K.a.Content,{visible:!0},"Search"),l.a.createElement(K.a.Content,{hidden:!0},l.a.createElement(N.a,{name:"arrow right"}))),l.a.createElement("span",null,l.a.createElement(q.a,{style:{minWidth:"11ch",paddingLeft:"10px",paddingRight:"10px"},defaultValue:!1,selection:!0,fluid:!0,options:[{key:1,value:!1,text:"leave at"},{key:2,value:!0,text:"arrive by"}],onChange:function(e,t){var a=t.value;W(a)}})),l.a.createElement("span",null,l.a.createElement(G.a,{defaultValue:x,type:"time",style:{maxWidth:"150px",paddingLeft:"5px",paddingRight:"5px"},onChange:function(e){return R(e.target.value)}})),l.a.createElement("span",null,l.a.createElement(G.a,{type:"date",style:{maxWidth:"163px"},value:M,onChange:function(e){return _(e.target.value)}}))))),l.a.createElement(L,null)),l.a.createElement(H.a,{inline:"centered",active:C}))}),te=(a(425),a(452)),ae=a(454),ne=a(458),re=a(148),le=a.n(re),oe={setLatlng:Y},ce=Object(v.b)(function(e){return{latlng:e.backgroundMapReducer,routes:e.routeReducer,activeTrail:e.trailReducer,mapClass:e.mapClassReducer}},oe)(function(e){var t=e.latlng,a=(e.setLatlng,e.routes),n=e.activeTrail,o=e.mapClass,c=Object(r.useState)([]),u=Object(O.a)(c,2),s=u[0],i=u[1];return console.log("mapclass bgmapin alussa: ",o),Object(r.useEffect)(function(){var e=[];if(a.length>0){e=a.map(function(e){return e.legs.map(function(e){return{color:"gray",decodedTrail:le.a.decode(e.legGeometry.points)}})}),console.log("activeTrail:",n),console.log("routes:",a);var t=a[n].legs.map(function(e){var t="red";return"WALK"===e.mode?t="green":"SUBWAY"===e.mode?t="orange":"BUS"===e.mode&&(t="blue"),{color:t,decodedTrail:le.a.decode(e.legGeometry.points),active:!0}});e.push(t)}console.log("alltrails:",e),i(e)},[a,n,o]),l.a.createElement(l.a.Fragment,null,console.log("latlng juuri ennen mappia: ",t),console.log("className ennen mappia: ",o),l.a.createElement(te.a,{className:o,center:t,zoom:12,maxZoom:19,attributionControl:!0,zoomControl:!0,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!0,animate:!0,easeLinearity:.35,onclick:function(e){console.log("lat, lng",[e.latlng.lat,e.latlng.lng])}},console.log("routes bgmapissa: ",a),console.log("trails ennen rendausta: ",s),s.map(function(e){return e.map(function(e){return l.a.createElement(ae.a,{color:e.color,positions:e.decodedTrail})})}),console.log("trails rendauksen j\xe4lkeen: ",s),l.a.createElement(ne.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})))}),ue=(a(426),function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(C,null),l.a.createElement(ce,null),l.a.createElement(ee,null))}),se=a(238),ie=a(75),me=a(233),de=Object(ie.c)({backgroundMapReducer:Z,routeReducer:f,trailReducer:A,mapClassReducer:m,formClassReducer:p}),pe=Object(ie.d)(de,Object(ie.a)(me.a)),ge=a(41),fe=a(71),ve=a(59),Ee=a(235),Ce=a(19),be=a(234),he=a(6),ye=new be.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0}}),Oe=Object(fe.b)({uri:"http://localhost:4000/graphql"}),Se=Object(Ee.a)(function(e,t){var a=t.headers,r=localStorage.getItem("app-user-token");return{headers:Object(n.a)({},a,{authorization:r?"bearer ".concat(r):null})}}),je=Object(Ce.d)(function(e){var t=e.query,a=Object(he.k)(t),n=a.kind,r=a.operation;return"OperationDefinition"===n&&"subscription"===r},ye,Se.concat(Oe)),Te=new ge.a({link:je,cache:new ve.a});c.a.render(l.a.createElement(se.a,{client:Te},l.a.createElement(j.a,{client:Te},l.a.createElement(v.a,{store:pe},l.a.createElement(ue,null)))),document.getElementById("root"))}},[[252,1,2]]]);
//# sourceMappingURL=main.3fc95b98.chunk.js.map