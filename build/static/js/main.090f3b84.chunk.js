(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{155:function(e,t,a){var n="http://localhost:4000/graphql";n=Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_WEBSOCKET_PORT:"ws://localhost:4000/graphql",REACT_APP_HTTP_PORT:"http://localhost:4000/graphql"}).PORT,e.exports={WSPORT:"ws://localhost:4000/graphql",PORT:n}},257:function(e,t,a){e.exports=a(441)},430:function(e,t,a){},431:function(e,t,a){},441:function(e,t,a){"use strict";a.r(t);var n=a(244),r=a(0),l=a.n(r),o=a(49),c=a.n(o),s=a(456),u=a(461),i=function(e){return{type:"SET_MAP_CLASS",value:e}},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"startMap",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MAP_CLASS":return t.value;default:return e}},p=function(e){return{type:"SET_FORM_CLASS",value:e}},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"startForm",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_FORM_CLASS":return t.value;default:return e}},g=function(e){return{type:"SET_ROUTES",value:e}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROUTES":return t.value;default:return e}},v=a(44),E={setMapClass:i,setFormClass:p,setRoutes:g},b=Object(v.b)(null,E)(function(e){var t=e.setMapClass,a=e.setFormClass,n=e.setRoutes;return l.a.createElement(l.a.Fragment,null,l.a.createElement(s.a,{className:"menu",inverted:!0,color:"blue",borderless:!0},l.a.createElement(s.a.Item,{name:"BetterHsl",active:!1,onClick:function(){a("startForm"),t("startMap"),n([])}},l.a.createElement(u.a,null,"BetterHsl"))))}),C=a(40),h=a.n(C),O=a(53),y=a(32),T=a(451),S=function(e){var t,a=Math.round(e);if(a>1e3){var n=Math.round(a%1e3/100),r=Math.floor(a/1e3);t="".concat(r,".").concat(n,"km")}else t="".concat(a,"m");return t},R=function(e){var t=new Date(e),a=t.getHours(),n=t.getMinutes();return n<10?"".concat(a,":0").concat(n):"".concat(a,":").concat(n)},j=a(65),w=function(e){var t=e.leg,a=R(t.startTime),n=S(t.distance);return l.a.createElement("li",{className:"timelineEvent"},l.a.createElement("span",{className:"timelineTime"},a),l.a.createElement("span",{className:"timelineSpacer"}),l.a.createElement("span",{className:"timelineFrom"},t.from.name),l.a.createElement(j.a,{name:"blind"}),l.a.createElement("span",{className:"timelineInfo"},n))},x=a(455),F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ACTIVE_TRAIL":return t.value;default:return e}},N=function(e){var t=e.route;console.log("route:",t);var a=R(t.legs[t.legs.length-1].endTime),n=R(t.legs[0].startTime),r=0;t.legs.forEach(function(e){"WALK"!==e.mode&&r++});var o=42/r+"ch";return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"routePreviewContainer"},t.legs.map(function(e){return"WALK"===e.mode?l.a.createElement(l.a.Fragment,null):l.a.createElement("span",{className:"routePreview",style:{maxWidth:o},key:e.duration},e.from.stop.name)})),l.a.createElement("div",null),l.a.createElement("span",{className:"divided"},l.a.createElement("span",{className:"previewDeparture"},n),t.legs.map(function(e){var a="red",n="train";return"WALK"===e.mode&&1!==t.legs.length?l.a.createElement(l.a.Fragment,null):("SUBWAY"===e.mode?(a="orange",n="subway"):"BUS"===e.mode?(a="blue",n="bus"):"WALK"===e.mode&&(a="lightblue",n="blind"),l.a.createElement(l.a.Fragment,null,l.a.createElement("span",null,l.a.createElement(j.a,{name:n})),l.a.createElement("span",{style:{color:a},className:"divider"})))}),l.a.createElement("span",{className:"previewArrival"},a),l.a.createElement(j.a,{name:"angle down",className:"expand_route",size:"big"})),l.a.createElement("div",null,l.a.createElement("span",{className:"routePreviewContainer"},t.legs.map(function(e){return"WALK"===e.mode?1===t.legs.length?l.a.createElement("span",{className:"routePreview",style:{maxWidth:o}},S(t.walkDistance)):l.a.createElement(l.a.Fragment,null):l.a.createElement("span",{className:"routePreview",style:{maxWidth:o}},e.trip.route.shortName)}))))},A={setActiveTrail:function(e){return{type:"SET_ACTIVE_TRAIL",value:e}}},k=Object(v.b)(function(e){return{routes:e.routeReducer}},A)(function(e){var t=e.setActiveTrail,a=e.routes,n=Object(r.useState)(-1),o=Object(y.a)(n,2),c=o[0],s=o[1],u=-1,i=function(e,a){var n=a.index,r=c===n?-1:n;r>=0&&t(r),s(r)};return 0===a.length?l.a.createElement(l.a.Fragment,null):l.a.createElement(l.a.Fragment,null,l.a.createElement(x.a,{fluid:!0,styled:!0},a.map(function(e){return u++,l.a.createElement(l.a.Fragment,null,l.a.createElement(x.a.Title,{onClick:i,index:u,active:c===u},l.a.createElement("span",{key:e.distance},l.a.createElement(N,{route:e}))),l.a.createElement(x.a.Content,{active:c===u},l.a.createElement("span",{className:"timeline"},e.legs.map(function(e){return l.a.createElement("div",{key:e.distance},l.a.createElement(w,{leg:e}))}))))})))}),_=a(457),L=a(64),M=a.n(L),P=a(225),B=a.n(P),I=function(){var e=Object(O.a)(h.a.mark(function e(t){var a,n,r,l,o,c,s,u,i;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],n=function(e){var t=e.data.features.map(function(e){return{title:e.properties.label,layer:e.properties.layer}});a=a.concat(t)},!t){e.next=30;break}return e.prev=3,r="https://api.digitransit.fi/geocoding/v1/search",l="https://api.digitransit.fi/geocoding/v1/autocomplete",o="boundary.polygon=25.5345%2060.2592%2C25.3881%2060.1693%2C25.3559%2060.102%2C25.3293%2059.9371%2C24.2831%2059.78402%2C24.2721%2059.95501%2C24.2899%2060.00895%2C24.3087%2060.01947%2C24.1994%2060.12753%2C24.1362%2060.1114%2C24.1305%2060.12847%2C24.099%2060.1405%2C24.0179%2060.1512%2C24.0049%2060.1901%2C24.0445%2060.1918%2C24.0373%2060.2036%2C24.0796%2060.2298%2C24.1652%2060.2428%2C24.3095%2060.2965%2C24.3455%2060.2488%2C24.428%2060.3002%2C24.5015%2060.2872%2C24.4888%2060.3306%2C24.5625%2060.3142%2C24.5957%2060.3242%2C24.6264%2060.3597%2C24.666%2060.3638%2C24.7436%2060.3441%2C24.9291%2060.4523%2C24.974%2060.5253%2C24.9355%2060.5131%2C24.8971%2060.562%2C25.0388%2060.5806%2C25.1508%2060.5167%2C25.1312%2060.4938%2C25.0385%2060.512%2C25.057%2060.4897%2C25.0612%2060.4485%2C25.1221%2060.4474%2C25.1188%2060.4583%2C25.149%2060.4621%2C25.1693%2060.5062%2C25.2242%2060.5016%2C25.3661%2060.4118%2C25.3652%2060.3756%2C25.5345%2060.2592&size=4",e.next=9,M.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=venue&").concat(o));case 9:return c=e.sent,n(c),e.next=13,M.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=street&").concat(o));case 13:return s=e.sent,n(s),e.next=17,M.a.get("".concat(r,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=address&").concat(o));case 17:return u=e.sent,n(u),e.next=21,M.a.get("".concat(l,"?text=").concat(t,"&focus.point.lat=60.168656&focus.point.lon=24.940899&layers=stop&").concat(o));case 21:return i=e.sent,console.log("stops:",i),n(i),e.abrupt("return",B.a.take(a,16));case 27:e.prev=27,e.t0=e.catch(3),console.log("REST API ERROR: ",e.t0);case 30:case"end":return e.stop()}},e,null,[[3,27]])}));return function(t){return e.apply(this,arguments)}}(),W=a(226),D=a.n(W),$=function(e){var t=e.fieldName,a=e.inputValue,n=e.setInputValue,o=Object(r.useState)(!1),c=Object(y.a)(o,2),s=c[0],u=c[1],i=Object(r.useState)([]),m=Object(y.a)(i,2),p=m[0],d=m[1],g=D()(function(){var e=Object(O.a)(h.a.mark(function e(t){var a;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<1)){e.next=2;break}return e.abrupt("return",v());case 2:return e.next=4,I(t);case 4:a=e.sent,console.log("autocompleteResults:",a),u(!1),d(a);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),200,[]),f=Object(y.a)(g,1)[0],v=function(){u(!1),d([]),n("")};return l.a.createElement(_.a,{fluid:!0,loading:s,onSearchChange:function(e){u(!0),n(e.target.value),f(e.target.value)},onResultSelect:function(e,t){var a=t.result;return n(a.title)},results:p,value:a,placeholder:t,resultRenderer:function(e){var t,a=e.title,n=e.layer;return t="venue"===n?"building":"stop"===n?"flag":"address"===n?"point":"map signs",l.a.createElement("div",null,l.a.createElement(j.a,{name:t}),a)}})},V=a(462),U=a(453),K=a(443),q=a(454),z=a(450),G=a(452),H=function(e){return{type:"SET_BACKGROUND_MAP_LOCATION",value:e}},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[60.1673319317496,24.80082397460938],[60.158966553797576,25.063716125488284]],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_BACKGROUND_MAP_LOCATION":return t.value;default:return e}},Z=a(228),J=a(151);function Q(){var e=Object(Z.a)(["\n  query planRoute(\n    $latFrom: Float\n    $lonFrom: Float\n    $latTo: Float\n    $lonTo: Float\n    $time: String\n    $date: String\n    $arriveBy: Boolean\n  ) {\n    planRoute(\n      latFrom: $latFrom\n      lonFrom: $lonFrom\n      latTo: $latTo\n      lonTo: $lonTo\n      time: $time\n      date: $date\n      arriveBy: $arriveBy\n    ) {\n      walkDistance\n      duration\n      legs {\n        legGeometry {\n          points\n        }\n        mode\n        startTime\n        endTime\n        trip {\n          route {\n            shortName\n            longName\n          }\n          tripHeadsign\n          stops {\n            name\n          }\n        }\n        from {\n          lat\n          lon\n          name\n          stop {\n            code\n            name\n          }\n        }\n        to {\n          lat\n          lon\n          name\n        }\n        distance\n      }\n    }\n  }\n"]);return Q=function(){return e},e}var X=Object(J.a)(Q()),ee=function(){var e=Object(O.a)(h.a.mark(function e(t){var a,n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.get("https://api.digitransit.fi/geocoding/v1/search?text=".concat(t,"&size=1"));case 2:return a=e.sent,n=a.data.features[0].geometry.coordinates,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),te={setRoutes:g,setBackgroundLocation:H,setMapClass:i,setClassState:p},ae=Object(v.b)(function(e){return{routes:e.routeReducer,classState:e.formClassReducer}},te)(function(e){var t=e.setRoutes,a=e.setBackgroundLocation,n=e.setMapClass,o=e.classState,c=e.setClassState,s=Object(r.useState)(""),u=Object(y.a)(s,2),i=u[0],m=u[1],p=Object(r.useState)(""),d=Object(y.a)(p,2),g=d[0],f=d[1],v=Object(r.useState)(!1),E=Object(y.a)(v,2),b=E[0],C=E[1],S=Object(r.useState)(""),w=Object(y.a)(S,2),x=w[0],F=w[1],N=Object(r.useState)(""),A=Object(y.a)(N,2),_=A[0],L=A[1],M=Object(r.useState)(!1),P=Object(y.a)(M,2),B=P[0],I=P[1],W=Object(T.b)();Object(r.useEffect)(function(){F(R(Date.now())),L(function(){var e=new Date,t=e.getMonth()<9?"0".concat(e.getMonth()+1):"".concat(e.getMonth()+1),a=e.getFullYear(),n=e.getDate()<10?"0".concat(e.getDate()):"".concat(e.getDate());return"".concat(a,"-").concat(t,"-").concat(n)}())},[]);var D=function(){var e=Object(O.a)(h.a.mark(function e(r){var l,o,s,u;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),t([]),""===i||""===g){e.next=19;break}return C(!0),c("resultsForm"),e.next=7,ee(i);case 7:return l=e.sent,e.next=10,ee(g);case 10:return o=e.sent,a([[l[1],l[0]],[o[1],o[0]]]),n("resultsMap"),e.next=15,W.query({query:X,variables:{latFrom:l[1],lonFrom:l[0],latTo:o[1],lonTo:o[0],time:"".concat(x,":00"),date:_,arriveBy:B}});case 15:s=e.sent,u=s.data.planRoute,C(!1),t(u);case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return l.a.createElement("div",{className:o},l.a.createElement(V.a,{raised:!0,style:{marginBottom:0}},l.a.createElement(U.a,{onSubmit:D},l.a.createElement(U.a.Field,null,l.a.createElement($,{inputValue:i,setInputValue:m,fieldName:"from"})),l.a.createElement(U.a.Field,null,l.a.createElement($,{inputValue:g,setInputValue:f,fieldName:"to"})),l.a.createElement(U.a.Field,null,l.a.createElement("div",{className:"toggleSearchTime"},l.a.createElement(K.a,{animated:!0,primary:!0,type:"submit",style:{marginRight:0}},l.a.createElement(K.a.Content,{visible:!0},"Search"),l.a.createElement(K.a.Content,{hidden:!0},l.a.createElement(j.a,{name:"arrow right"}))),l.a.createElement("span",null,l.a.createElement(q.a,{style:{minWidth:"11ch",paddingLeft:"10px",paddingRight:"10px"},defaultValue:!1,selection:!0,fluid:!0,options:[{key:1,value:!1,text:"leave at"},{key:2,value:!0,text:"arrive by"}],onChange:function(e,t){var a=t.value;I(a)}})),l.a.createElement("span",null,l.a.createElement(z.a,{className:"timeInput",defaultValue:x,type:"time",onChange:function(e){return F(e.target.value)}})),l.a.createElement("span",null,l.a.createElement(z.a,{type:"date",style:{maxWidth:"163px"},value:_,onChange:function(e){return L(e.target.value)}})))))),l.a.createElement(k,null),l.a.createElement(G.a,{inline:"centered",active:b,style:{marginTop:"10px"}}))}),ne=(a(429),a(458)),re=a(459),le=a(463),oe=a(154),ce=a.n(oe),se={setLatlng:H},ue=Object(v.b)(function(e){return{latlng:e.backgroundMapReducer,routes:e.routeReducer,activeTrail:e.trailReducer,mapClass:e.mapClassReducer}},se)(function(e){var t=e.latlng,a=(e.setLatlng,e.routes),n=e.activeTrail,o=e.mapClass,c=Object(r.useState)([]),s=Object(y.a)(c,2),u=s[0],i=s[1];return console.log("mapclass bgmapin alussa: ",o),Object(r.useEffect)(function(){var e=[];if(a.length>0){e=a.map(function(e){return e.legs.map(function(e){return{color:"gray",decodedTrail:ce.a.decode(e.legGeometry.points)}})}),console.log("activeTrail:",n),console.log("routes:",a);var t=a[n].legs.map(function(e){var t="green";return"WALK"===e.mode?t="lightblue":"SUBWAY"===e.mode?t="orange":"BUS"===e.mode?t="blue":"RAIL"===e.mode&&(t="red"),{color:t,decodedTrail:ce.a.decode(e.legGeometry.points),active:!0}});e.push(t)}console.log("alltrails:",e),i(e)},[a,n,o]),l.a.createElement(l.a.Fragment,null,console.log("latlng juuri ennen mappia: ",t),console.log("className ennen mappia: ",o),l.a.createElement(ne.a,{className:o,zoom:13,maxZoom:19,attributionControl:!0,zoomControl:!0,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!0,animate:!0,easeLinearity:.35,bounds:t,boundsOptions:{padding:[10,10]},onclick:function(e){console.log("lat, lng",[e.latlng.lat,e.latlng.lng])}},console.log("routes bgmapissa: ",a),console.log("trails ennen rendausta: ",u),u.map(function(e){return e.map(function(e){return l.a.createElement(re.a,{color:e.color,positions:e.decodedTrail})})}),console.log("trails rendauksen j\xe4lkeen: ",u),l.a.createElement(le.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})))}),ie=(a(430),a(431),function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(b,null),l.a.createElement(ue,null),l.a.createElement(ae,null))}),me=a(242),pe=a(78),de=a(239),ge=Object(pe.c)({backgroundMapReducer:Y,routeReducer:f,trailReducer:F,mapClassReducer:m,formClassReducer:d}),fe=Object(pe.d)(ge,Object(pe.a)(de.a)),ve=a(55),Ee=a(75),be=a(63),Ce=a(241),he=a(19),Oe=a(240),ye=a(6),Te=a(155),Se=a.n(Te),Re=new Oe.a({uri:Se.a.WSPORT,options:{reconnect:!0}}),je=Object(Ee.b)({uri:Se.a.PORT}),we=Object(Ce.a)(function(e,t){var a=t.headers,r=localStorage.getItem("app-user-token");return{headers:Object(n.a)({},a,{authorization:r?"bearer ".concat(r):null})}}),xe=Object(he.d)(function(e){var t=e.query,a=Object(ye.k)(t),n=a.kind,r=a.operation;return"OperationDefinition"===n&&"subscription"===r},Re,we.concat(je)),Fe=new ve.a({link:xe,cache:new be.a});c.a.render(l.a.createElement(me.a,{client:Fe},l.a.createElement(T.a,{client:Fe},l.a.createElement(v.a,{store:fe},l.a.createElement(ie,null)))),document.getElementById("root"))}},[[257,1,2]]]);
//# sourceMappingURL=main.090f3b84.chunk.js.map